---
  - hosts: db

    gather_facts: yes

    become: true

    tasks:

    # - name: Import the public key used by the package management system
    #   apt_key: keyserver=hkp://keyserver.ubuntu.com:80 id=7F0CEB10 state=present
    #
    # - name: Add MongoDB repository
    #   apt_repository: repo='deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen' state=present
    #
    # - name: install mongodb
    #   apt: pkg=mongodb-org state=latest update_cache=yes
    #   notify:
    #   - start mongodb
    #
    # handlers:
    #   - name: start mongodb
    #     service: name=mongod state=started

    - name: MongoDB - Import public key
      apt_key:
        keyserver: hkp://keyserver.ubuntu.com:80
        id: EA312927
    - name: Update and upgrade apt packages
      become: true
      apt:
        upgrade: yes
        update_cache: yes
    - name: MongoDB - Add repository
      apt_repository:
        filename: '/etc/apt/sources.list.d/mongodb-org-3.2.list'
        repo: 'deb http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.2 multiverse'
        state: present
        update_cache: yes
    - name: MongoDB - Install MongoDB
      apt:
        name: mongodb-org
        state: present
        update_cache: yes
      ignore_errors: yes
    - name: MongoDB - Running state
      service:
        name: mongod
        state: started
      ignore_errors: yes
    - name: bind ip
      lineinfile:
        path: /etc/mongod.conf
        line: s,\\(^[[:blank:]]*bindIp:\\) .*,\\1 0.0.0.0,
    handlers:
      - name: restart mongodb
        service: name=mongodb state=restarted
